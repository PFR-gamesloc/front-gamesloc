"use strict";(self.webpackChunkfront_gamesloc=self.webpackChunkfront_gamesloc||[]).push([[542],{721:(f,C,r)=>{r.d(C,{V:()=>h});var g=r(8645),d=r(5619),t=r(553),_=r(5879),p=r(9862);let h=(()=>{var m;class s{constructor(c){this.httpClient=c,this.cartItemsSubject=new g.x,this.totalPrice=new d.X(this.updatePrice()),this.baseUrl=t.N.baseUrl}getCartItemsObservable(){return this.cartItemsSubject.asObservable()}emitCartItemsUpdate(){this.totalPrice.next(this.updatePrice()),this.cartItemsSubject.next(this.getItems())}addItem(c){const l=this.getItems();return l.some(P=>P.gameId===c.gameId)?{success:!1,message:"Le jeu existe d\xe9j\xe0 dans le panier. Ajout annul\xe9."}:(l.push(c),localStorage.setItem("articles",JSON.stringify(l)),this.emitCartItemsUpdate(),{success:!0,message:"Le jeu a bien \xe9t\xe9 ajouter au panier !"})}getItems(){const c=localStorage.getItem("articles");return c?JSON.parse(c):[]}clearItems(){localStorage.removeItem("articles")}removeItem(c){const l=this.getItems().filter(P=>P.gameId!==c.gameId);localStorage.setItem("articles",JSON.stringify(l)),this.emitCartItemsUpdate()}validateCart(c){return this.httpClient.post(`${this.baseUrl}/customer/me/create-order`,c)}updatePrice(){if(0===this.getItems().length)return 0;{let c=0;for(const l of this.getItems())c+=l.gamePrice;return c}}}return(m=s).\u0275fac=function(c){return new(c||m)(_.LFG(p.eN))},m.\u0275prov=_.Yz7({token:m,factory:m.\u0275fac,providedIn:"root"}),s})()},5631:(f,C,r)=>{r.d(C,{J:()=>_});var g=r(9862),d=r(553),t=r(5879);let _=(()=>{var p;class h{constructor(s){this.http=s,this.baseUrl=d.N.baseUrl}upload(s){const v=new FormData;v.append("file",s);const c=new g.aW("POST",`${this.baseUrl}/admin/game/upload`,v,{reportProgress:!0,responseType:"json"});return this.http.request(c)}getFile(s){return this.http.get(`${this.baseUrl}/product/img/${s}`,{responseType:"blob"})}}return(p=h).\u0275fac=function(s){return new(s||p)(t.LFG(g.eN))},p.\u0275prov=t.Yz7({token:p,factory:p.\u0275fac,providedIn:"root"}),h})()},5542:(f,C,r)=>{r.r(C),r.d(C,{CartModule:()=>U});var g=r(6814),d=r(1896),t=r(5879),_=r(721),p=r(304),h=r(1538),m=r(5631),s=r(6843);let v=(()=>{var e;class i{constructor(n,o){this.cartService=n,this.fileService=o,this.removeItemEvent=new t.vpe,this.image=""}ngOnInit(){this.fileService.getFile(this.item.image).subscribe({next:n=>this.image=URL.createObjectURL(n)})}removeFromCart(n){this.cartService.removeItem(n),this.cartService.emitCartItemsUpdate()}}return(e=i).\u0275fac=function(n){return new(n||e)(t.Y36(_.V),t.Y36(m.J))},e.\u0275cmp=t.Xpm({type:e,selectors:[["app-cart-item"]],inputs:{item:"item"},outputs:{removeItemEvent:"removeItemEvent"},decls:10,vars:3,consts:[[1,"container"],[1,"cart-item-container"],[1,"item"],["alt","",3,"src"],[1,"cart-price"],["size","25","name","bootstrapTrash",3,"click"]],template:function(n,o){1&n&&(t.TgZ(0,"div",0)(1,"h2"),t._uU(2),t.qZA(),t.TgZ(3,"div",1)(4,"div",2),t._UZ(5,"img",3),t.TgZ(6,"div",4)(7,"h4"),t._uU(8),t.qZA(),t.TgZ(9,"ng-icon",5),t.NdJ("click",function(){return o.removeFromCart(o.item)}),t.qZA()()()()()),2&n&&(t.xp6(2),t.Oqu(o.item.gameName),t.xp6(3),t.Q6J("src",o.image,t.LSH),t.xp6(3),t.Oqu(o.item.gamePrice))},dependencies:[s.Fv],styles:[".container[_ngcontent-%COMP%]{text-align:center}.container[_ngcontent-%COMP%]   .cart-item-container[_ngcontent-%COMP%]{display:flex;justify-content:center;text-align:center}.container[_ngcontent-%COMP%]   .cart-item-container[_ngcontent-%COMP%]   .item[_ngcontent-%COMP%]{margin:1rem 1rem 0;width:100%;display:flex;align-items:center;border:1px solid #ccc;border-radius:5px;box-shadow:0 2px 4px #0000001a}.container[_ngcontent-%COMP%]   .cart-item-container[_ngcontent-%COMP%]   .item[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{text-align:center}@media (min-width: 768px){.container[_ngcontent-%COMP%]   .cart-item-container[_ngcontent-%COMP%]   .item[_ngcontent-%COMP%]{width:50%}}@media (min-width: 1024px){.container[_ngcontent-%COMP%]   .cart-item-container[_ngcontent-%COMP%]   .item[_ngcontent-%COMP%]{width:50%}}.container[_ngcontent-%COMP%]   .cart-item-container[_ngcontent-%COMP%]   .cart-price[_ngcontent-%COMP%]{width:100%;display:flex;flex-direction:column;text-align:center;align-items:center;justify-content:space-around;gap:2rem}.container[_ngcontent-%COMP%]   .cart-item-container[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:50%}"]}),i})();function c(e,i){if(1&e&&(t.TgZ(0,"div",8),t._UZ(1,"app-cart-item",9),t.qZA()),2&e){const a=i.$implicit;t.xp6(1),t.Q6J("item",a)}}function l(e,i){if(1&e){const a=t.EpF();t.TgZ(0,"div",10)(1,"div",11)(2,"p"),t._uU(3,"Achat effectu\xe9 avec succ\xe8s !"),t.qZA(),t.TgZ(4,"p"),t._uU(5),t.qZA(),t.TgZ(6,"button",12),t.NdJ("click",function(){t.CHM(a);const o=t.oxw();return t.KtG(o.closePurchasePopup())}),t._uU(7,"Fermer"),t.qZA()()()}if(2&e){const a=t.oxw();t.xp6(5),t.hij("Prix total : ",a.totalPrice,"")}}function P(e,i){1&e&&(t.ynx(0),t.TgZ(1,"h2"),t._uU(2,"Votre panier est vide !"),t.qZA(),t.BQk())}function O(e,i){1&e&&(t.ynx(0),t.TgZ(1,"h2"),t._uU(2,"Connectez vous pour valider le panier"),t.qZA(),t.BQk())}function M(e,i){if(1&e&&(t.ynx(0),t.YNc(1,P,3,0,"ng-container",13),t.YNc(2,O,3,0,"ng-container",13),t._UZ(3,"app-btn-component",14),t.BQk()),2&e){const a=t.oxw();t.xp6(1),t.Q6J("ngIf",a.isEmptyCart()),t.xp6(1),t.Q6J("ngIf",!a.isEmptyCart()&&!a.isAuth),t.xp6(1),t.Q6J("disabled",!0)}}function x(e,i){if(1&e){const a=t.EpF();t.TgZ(0,"app-btn-component",15),t.NdJ("click",function(){t.CHM(a);const o=t.oxw();return t.KtG(o.validateCart())}),t.qZA()}}const I=[{path:"",component:(()=>{var e;class i{constructor(n,o,u){this.cartService=n,this.router=o,this.authService=u,this.cartItems=[],this.isCartEmpty=!1,this.purchaseResponse=0}ngOnInit(){this.cartItems=this.cartService.getItems(),this.cartItems$=this.cartService.getCartItemsObservable(),this.cartItems$.subscribe(n=>{this.cartItems=n}),this.authService.isAuth.subscribe(n=>this.isAuth=n),this.cartService.totalPrice.subscribe(n=>this.totalPrice=n)}validateCart(){const o={price:this.totalPrice,gamesId:this.cartItems.map(u=>u.gameId)};this.cartService.validateCart(o).subscribe({next:u=>{this.purchaseResponse=u,this.cartService.clearItems(),this.cartService.emitCartItemsUpdate(),this.router.navigate(["/"])}})}isEmptyCart(){return 0===this.cartItems.length}closePurchasePopup(){this.purchaseResponse=0}}return(e=i).\u0275fac=function(n){return new(n||e)(t.Y36(_.V),t.Y36(d.F0),t.Y36(p.e))},e.\u0275cmp=t.Xpm({type:e,selectors:[["app-cart-page"]],decls:15,vars:5,consts:[[1,"cart-container"],[1,"title"],["class","cart-item",4,"ngFor","ngForOf"],[1,"total-price-container"],[1,"total-price"],["class","purchase-overlay",4,"ngIf"],[4,"ngIf","ngIfElse"],["canPurchase",""],[1,"cart-item"],[3,"item"],[1,"purchase-overlay"],[1,"purchase-popup"],[3,"click"],[4,"ngIf"],["classBtn","btn btn-add app-btn-last","textBtn","Valider le panier",3,"disabled"],["classBtn","btn btn-add app-btn-last","textBtn","Valider le panier",3,"click"]],template:function(n,o){if(1&n&&(t.TgZ(0,"div",0)(1,"div",1)(2,"h1"),t._uU(3,"Panier"),t.qZA()(),t.YNc(4,c,2,1,"div",2),t.TgZ(5,"div",3)(6,"div",4)(7,"p"),t._uU(8,"Prix total:"),t.qZA(),t.TgZ(9,"p"),t._uU(10),t.qZA()()(),t.YNc(11,l,8,1,"div",5),t.YNc(12,M,4,3,"ng-container",6),t.YNc(13,x,1,0,"ng-template",null,7,t.W1O),t.qZA()),2&n){const u=t.MAs(14);t.xp6(4),t.Q6J("ngForOf",o.cartItems),t.xp6(6),t.Oqu(o.totalPrice),t.xp6(1),t.Q6J("ngIf",o.purchaseResponse),t.xp6(1),t.Q6J("ngIf",o.isEmptyCart()||!o.isAuth)("ngIfElse",u)}},dependencies:[g.sg,g.O5,h.H,v],styles:[".cart-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:2rem;align-items:center;margin:2rem;padding-bottom:1rem;border:1px solid var(--primary);border-radius:10px;background-color:var(--whitegray)}.cart-container[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]{background-color:var(--primary);display:flex;width:100%;justify-content:space-evenly;border-radius:10px 10px 0 0}.cart-container[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{color:var(--blue-primary)}.cart-container[_ngcontent-%COMP%]   .total-price-container[_ngcontent-%COMP%]{display:flex;align-items:center;width:100%;padding-top:1rem;justify-content:center}.cart-container[_ngcontent-%COMP%]   .total-price[_ngcontent-%COMP%]{background-color:var(--primary);color:#fff;border-radius:5px;display:flex;align-items:center;padding:.5rem 1rem}.cart-container[_ngcontent-%COMP%]   .total-price[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0}.cart-container[_ngcontent-%COMP%]   .purchase-overlay[_ngcontent-%COMP%]{position:fixed;top:0;left:0;width:100%;height:100%;background-color:#3a506b80;display:flex;justify-content:center;align-items:center;z-index:1}.cart-container[_ngcontent-%COMP%]   .purchase-overlay[_ngcontent-%COMP%]   .purchase-popup[_ngcontent-%COMP%]{background-color:var(--secondary);padding:20px;border-radius:10px;box-shadow:0 4px 12px #0003;max-width:400px;text-align:center}.cart-container[_ngcontent-%COMP%]   .purchase-overlay[_ngcontent-%COMP%]   .purchase-popup[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{color:var(--blue-primary);margin-bottom:10px}.cart-container[_ngcontent-%COMP%]   .purchase-overlay[_ngcontent-%COMP%]   .purchase-popup[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:var(--blue-secondary)}.cart-container[_ngcontent-%COMP%]   .purchase-overlay[_ngcontent-%COMP%]   .purchase-popup[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{background-color:var(--blue-primary);color:#fff;border:none;padding:10px 20px;border-radius:5px;cursor:pointer;transition:background-color .3s ease}.cart-container[_ngcontent-%COMP%]   .purchase-overlay[_ngcontent-%COMP%]   .purchase-popup[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover{background-color:var(--blue-secondary)}"]}),i})()}];let b=(()=>{var e;class i{}return(e=i).\u0275fac=function(n){return new(n||e)},e.\u0275mod=t.oAB({type:e}),e.\u0275inj=t.cJS({imports:[d.Bz.forChild(I),d.Bz]}),i})();var y=r(6208),T=r(2150);let U=(()=>{var e;class i{}return(e=i).\u0275fac=function(n){return new(n||e)},e.\u0275mod=t.oAB({type:e}),e.\u0275inj=t.cJS({imports:[g.ez,b,y.m,s.sU.withIcons({bootstrapTrash:T.FkR})]}),i})()}}]);