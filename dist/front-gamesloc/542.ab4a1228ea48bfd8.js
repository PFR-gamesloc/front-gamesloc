"use strict";(self.webpackChunkfront_gamesloc=self.webpackChunkfront_gamesloc||[]).push([[542],{721:(M,C,r)=>{r.d(C,{V:()=>v});var g=r(8645),u=r(5619),t=r(9547),h=r(4336),_=r(5879),m=r(9862);let v=(()=>{var l;class s{constructor(o){this.httpClient=o,this.cartItemsSubject=new g.x,this.totalPrice=new u.X(0),this.baseUrl=t.d.production?t.d.baseUrl:h.O.baseUrl}getCartItemsObservable(){return this.cartItemsSubject.asObservable()}emitCartItemsUpdate(){this.updatePrice(),this.cartItemsSubject.next(this.getItems())}addItem(o){const p=this.getItems();return p.some(O=>O.gameId===o.gameId)?{success:!1,message:"Le jeu existe d\xe9j\xe0 dans le panier. Ajout annul\xe9."}:(p.push(o),localStorage.setItem("articles",JSON.stringify(p)),this.emitCartItemsUpdate(),{success:!0,message:"Le jeu a bien \xe9t\xe9 ajouter au panier !"})}getItems(){const o=localStorage.getItem("articles");return o?JSON.parse(o):[]}clearItems(){localStorage.removeItem("articles")}removeItem(o){const p=this.getItems().filter(O=>O.gameId!==o.gameId);localStorage.setItem("articles",JSON.stringify(p)),this.emitCartItemsUpdate()}validateCart(o){return this.httpClient.post(`${this.baseUrl}/customer/me/create-order`,o)}updatePrice(){if(0===this.getItems().length)this.totalPrice.next(0);else{let o=0;for(const p of this.getItems())o+=p.gamePrice;this.totalPrice.next(o)}}}return(l=s).\u0275fac=function(o){return new(o||l)(_.LFG(m.eN))},l.\u0275prov=_.Yz7({token:l,factory:l.\u0275fac,providedIn:"root"}),s})()},5631:(M,C,r)=>{r.d(C,{J:()=>_});var g=r(9862),u=r(9547),t=r(4336),h=r(5879);let _=(()=>{var m;class v{constructor(s){this.http=s,this.baseUrl=u.d.production?u.d.baseUrl:t.O.baseUrl}upload(s){const P=new FormData;P.append("file",s);const o=new g.aW("POST",`${this.baseUrl}/admin/game/upload`,P,{reportProgress:!0,responseType:"json"});return this.http.request(o)}getFile(s){return this.http.get(`${this.baseUrl}/product/img/${s}`,{responseType:"blob"})}}return(m=v).\u0275fac=function(s){return new(s||m)(h.LFG(g.eN))},m.\u0275prov=h.Yz7({token:m,factory:m.\u0275fac,providedIn:"root"}),v})()},5542:(M,C,r)=>{r.r(C),r.d(C,{CartModule:()=>y});var g=r(6814),u=r(1896),t=r(5879),h=r(721),_=r(304),m=r(1538),v=r(5631),l=r(6843);let s=(()=>{var e;class i{constructor(n,a){this.cartService=n,this.fileService=a,this.removeItemEvent=new t.vpe,this.image=""}ngOnInit(){this.fileService.getFile(this.item.image).subscribe({next:n=>this.image=URL.createObjectURL(n)})}removeFromCart(n){this.cartService.removeItem(n),this.cartService.emitCartItemsUpdate()}}return(e=i).\u0275fac=function(n){return new(n||e)(t.Y36(h.V),t.Y36(v.J))},e.\u0275cmp=t.Xpm({type:e,selectors:[["app-cart-item"]],inputs:{item:"item"},outputs:{removeItemEvent:"removeItemEvent"},decls:10,vars:3,consts:[[1,"container"],[1,"cart-item-container"],[1,"item"],["alt","",3,"src"],[1,"cart-price"],["size","25","name","bootstrapTrash",3,"click"]],template:function(n,a){1&n&&(t.TgZ(0,"div",0)(1,"h2"),t._uU(2),t.qZA(),t.TgZ(3,"div",1)(4,"div",2),t._UZ(5,"img",3),t.TgZ(6,"div",4)(7,"h4"),t._uU(8),t.qZA(),t.TgZ(9,"ng-icon",5),t.NdJ("click",function(){return a.removeFromCart(a.item)}),t.qZA()()()()()),2&n&&(t.xp6(2),t.Oqu(a.item.gameName),t.xp6(3),t.Q6J("src",a.image,t.LSH),t.xp6(3),t.Oqu(a.item.gamePrice))},dependencies:[l.Fv],styles:[".container[_ngcontent-%COMP%]{text-align:center}.container[_ngcontent-%COMP%]   .cart-item-container[_ngcontent-%COMP%]{display:flex;justify-content:center;text-align:center}.container[_ngcontent-%COMP%]   .cart-item-container[_ngcontent-%COMP%]   .item[_ngcontent-%COMP%]{margin:1rem 1rem 0;width:100%;display:flex;align-items:center;border:1px solid #ccc;border-radius:5px;box-shadow:0 2px 4px #0000001a}.container[_ngcontent-%COMP%]   .cart-item-container[_ngcontent-%COMP%]   .item[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{text-align:center}@media (min-width: 768px){.container[_ngcontent-%COMP%]   .cart-item-container[_ngcontent-%COMP%]   .item[_ngcontent-%COMP%]{width:50%}}@media (min-width: 1024px){.container[_ngcontent-%COMP%]   .cart-item-container[_ngcontent-%COMP%]   .item[_ngcontent-%COMP%]{width:50%}}.container[_ngcontent-%COMP%]   .cart-item-container[_ngcontent-%COMP%]   .cart-price[_ngcontent-%COMP%]{width:100%;display:flex;flex-direction:column;text-align:center;align-items:center;justify-content:space-around;gap:2rem}.container[_ngcontent-%COMP%]   .cart-item-container[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:50%}"]}),i})();function P(e,i){if(1&e&&(t.TgZ(0,"div",8),t._UZ(1,"app-cart-item",9),t.qZA()),2&e){const c=i.$implicit;t.xp6(1),t.Q6J("item",c)}}function o(e,i){if(1&e){const c=t.EpF();t.TgZ(0,"div",10)(1,"div",11)(2,"p"),t._uU(3,"Achat effectu\xe9 avec succ\xe8s !"),t.qZA(),t.TgZ(4,"p"),t._uU(5),t.qZA(),t.TgZ(6,"button",12),t.NdJ("click",function(){t.CHM(c);const a=t.oxw();return t.KtG(a.closePurchasePopup())}),t._uU(7,"Fermer"),t.qZA()()()}if(2&e){const c=t.oxw();t.xp6(5),t.hij("Prix total : ",c.totalPrice,"")}}function p(e,i){1&e&&(t.ynx(0),t._UZ(1,"app-btn-component",13),t.BQk()),2&e&&(t.xp6(1),t.Q6J("disabled",!0))}function O(e,i){if(1&e){const c=t.EpF();t.TgZ(0,"app-btn-component",14),t.NdJ("click",function(){t.CHM(c);const a=t.oxw();return t.KtG(a.validateCart())}),t.qZA()}}const f=[{path:"",component:(()=>{var e;class i{constructor(n,a,d){this.cartService=n,this.router=a,this.authService=d,this.cartItems=[],this.totalPrice=0,this.isCartEmpty=!1,this.purchaseResponse=0}ngOnInit(){this.cartItems=this.cartService.getItems(),this.cartItems$=this.cartService.getCartItemsObservable(),this.cartItems$.subscribe(n=>{this.cartItems=n}),this.authService.isAuth.subscribe(n=>this.isAuth=n),this.cartService.totalPrice.subscribe(n=>this.totalPrice=n)}validateCart(){const a={price:this.totalPrice,gamesId:this.cartItems.map(d=>d.gameId)};this.cartService.validateCart(a).subscribe({next:d=>{this.purchaseResponse=d,this.cartService.clearItems(),this.cartService.emitCartItemsUpdate(),this.router.navigate(["/"])}})}isEmptyCart(){return 0===this.cartItems.length}closePurchasePopup(){this.purchaseResponse=0}}return(e=i).\u0275fac=function(n){return new(n||e)(t.Y36(h.V),t.Y36(u.F0),t.Y36(_.e))},e.\u0275cmp=t.Xpm({type:e,selectors:[["app-cart-page"]],decls:15,vars:5,consts:[[1,"cart-container"],[1,"title"],["class","cart-item",4,"ngFor","ngForOf"],[1,"total-price-container"],[1,"total-price"],["class","purchase-overlay",4,"ngIf"],[4,"ngIf","ngIfElse"],["canPurchase",""],[1,"cart-item"],[3,"item"],[1,"purchase-overlay"],[1,"purchase-popup"],[3,"click"],["classBtn","btn btn-add app-btn-last","textBtn","Valider le panier",3,"disabled"],["classBtn","btn btn-add app-btn-last","textBtn","Valider le panier",3,"click"]],template:function(n,a){if(1&n&&(t.TgZ(0,"div",0)(1,"div",1)(2,"h1"),t._uU(3,"Panier"),t.qZA()(),t.YNc(4,P,2,1,"div",2),t.TgZ(5,"div",3)(6,"div",4)(7,"p"),t._uU(8,"Prix total:"),t.qZA(),t.TgZ(9,"p"),t._uU(10),t.qZA()()(),t.YNc(11,o,8,1,"div",5),t.YNc(12,p,2,1,"ng-container",6),t.YNc(13,O,1,0,"ng-template",null,7,t.W1O),t.qZA()),2&n){const d=t.MAs(14);t.xp6(4),t.Q6J("ngForOf",a.cartItems),t.xp6(6),t.Oqu(a.totalPrice),t.xp6(1),t.Q6J("ngIf",a.purchaseResponse),t.xp6(1),t.Q6J("ngIf",a.isEmptyCart()||!a.isAuth)("ngIfElse",d)}},dependencies:[g.sg,g.O5,m.H,s],styles:[".cart-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:2rem;align-items:center;margin:2rem;padding-bottom:1rem;border:1px solid var(--primary);border-radius:10px;background-color:var(--whitegray)}.cart-container[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]{background-color:var(--primary);display:flex;width:100%;justify-content:space-evenly;border-radius:10px 10px 0 0}.cart-container[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{color:var(--blue-primary)}.cart-container[_ngcontent-%COMP%]   .total-price-container[_ngcontent-%COMP%]{display:flex;align-items:center;width:100%;padding-top:1rem;justify-content:center}.cart-container[_ngcontent-%COMP%]   .total-price[_ngcontent-%COMP%]{background-color:var(--primary);color:#fff;border-radius:5px;display:flex;align-items:center;padding:.5rem 1rem}.cart-container[_ngcontent-%COMP%]   .total-price[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0}.cart-container[_ngcontent-%COMP%]   .purchase-overlay[_ngcontent-%COMP%]{position:fixed;top:0;left:0;width:100%;height:100%;background-color:#3a506b80;display:flex;justify-content:center;align-items:center;z-index:1}.cart-container[_ngcontent-%COMP%]   .purchase-overlay[_ngcontent-%COMP%]   .purchase-popup[_ngcontent-%COMP%]{background-color:var(--secondary);padding:20px;border-radius:10px;box-shadow:0 4px 12px #0003;max-width:400px;text-align:center}.cart-container[_ngcontent-%COMP%]   .purchase-overlay[_ngcontent-%COMP%]   .purchase-popup[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{color:var(--blue-primary);margin-bottom:10px}.cart-container[_ngcontent-%COMP%]   .purchase-overlay[_ngcontent-%COMP%]   .purchase-popup[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:var(--blue-secondary)}.cart-container[_ngcontent-%COMP%]   .purchase-overlay[_ngcontent-%COMP%]   .purchase-popup[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{background-color:var(--blue-primary);color:#fff;border:none;padding:10px 20px;border-radius:5px;cursor:pointer;transition:background-color .3s ease}.cart-container[_ngcontent-%COMP%]   .purchase-overlay[_ngcontent-%COMP%]   .purchase-popup[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover{background-color:var(--blue-secondary)}"]}),i})()}];let I=(()=>{var e;class i{}return(e=i).\u0275fac=function(n){return new(n||e)},e.\u0275mod=t.oAB({type:e}),e.\u0275inj=t.cJS({imports:[u.Bz.forChild(f),u.Bz]}),i})();var x=r(6208),b=r(2150);let y=(()=>{var e;class i{}return(e=i).\u0275fac=function(n){return new(n||e)},e.\u0275mod=t.oAB({type:e}),e.\u0275inj=t.cJS({imports:[g.ez,I,x.m,l.sU.withIcons({bootstrapTrash:b.FkR})]}),i})()}}]);